# 集合

## 不可变集合

[官方文档](https://github.com/google/guava/wiki/ImmutableCollectionsExplained)

可变集合接口 | 属于JDK还是Guava | 不可变版本
--|--|--
Collection | JDK | ImmutableCollection
List | JDK | ImmutableList
Set | JDK | ImmutableSet
SortedSet/NavigableSet | JDK | ImmutableSortedSet
Map | JDK | ImmutableMap
SortedMap | JDK | ImmutableSortedMap
Multiset | Guava | ImmutableMultiset
SortedMultiset | Guava | ImmutableSortedMultiset
Multimap | Guava | ImmutableMultimap
ListMultimap | Guava | ImmutableListMultimap
SetMultimap | Guava | ImmutableSetMultimap
BiMap | Guava | ImmutableBiMap
ClassToInstanceMap | Guava | ImmutableClassToInstanceMap
Table | Guava | ImmutableTable

## 新的集合

[官方文档](https://github.com/google/guava/wiki/NewCollectionTypesExplained)

### Multiset的各种实现

Multiset继承自JDK中的Collection接口

具有以下两种特性：

- 没有元素顺序限制的`ArrayList<E>`

- `Map<E, Integer>`，键为元素，值为计数

Map | 对应的Multiset | 是否支持null元素
--|--|--
HashMap | HashMultiset | 是
TreeMap | TreeMultiset | 是（如果comparator支持的话）
LinkedHashMap | LinkedHashMultiset | 是
ConcurrentHashMap | ConcurrentHashMultiset | 否
ImmutableMap | ImmutableMultiset | 否

SortedMultiset是Multiset 接口的变种，它支持高效地获取指定范围的子集。比方说，你可以用 latencies.subMultiset(0,BoundType.CLOSED, 100, BoundType.OPEN).size()来统计你的站点中延迟在100毫秒以内的访问，然后把这个值和latencies.size()相比，以获取这个延迟水平在总体访问中的比例。

TreeMultiset实现SortedMultiset接口。在撰写本文档时，ImmutableSortedMultiset还在测试和GWT的兼容性。

### Multimap的各种实现

Multimap 其数据结构为 

`a -> 1 a -> 2 a ->4 b -> 3 c -> 5`

但asMap()视图返回`Map<K, Collection<V>>`，可以理解为

`a -> [1, 2, 4] b -> 3 c -> 5`

不会有任何键映射到空集合：一个键要么至少到一个值，要么根本就不在Multimap中。

很少会直接使用Multimap接口，更多时候你会用ListMultimap或SetMultimap接口，它们分别把键映射到List或Set。

实现 | 键行为类似 | 值行为类似
--|--|--
ArrayListMultimap | HashMap | ArrayList
HashMultimap | HashMap | HashSet
LinkedListMultimap* | LinkedHashMap* | LinkedList*
LinkedHashMultimap** | LinkedHashMap | LinkedHashMap
TreeMultimap | TreeMap | TreeSet
ImmutableListMultimap | ImmutableMap | ImmutableList
ImmutableSetMultimap | ImmutableMap | ImmutableSet

### BiMap的各种实现

BiMap  双向map

键–值实现 | 值–键实现 | 对应的BiMap实现
--|--|--
HashMap | HashMap | HashBiMap
ImmutableMap | ImmutableMap | ImmutableBiMap
EnumMap | EnumMap | EnumBiMap
EnumMap | HashMap | EnumHashBiMap

### Table实现：

Table 行，列，值

其数据结构为`Table<R,C,V>`

也可以理解为`Map<R, Map<C, V>`

实现 | 描述
--|--
HashBasedTable | 本质上用HashMap<R, HashMap<C, V>>实现；
TreeBasedTable | 本质上用TreeMap<R, TreeMap<C,V>>实现；
ImmutableTable | 本质上用ImmutableMap<R, ImmutableMap<C, V>>实现；注：ImmutableTable对稀疏或密集的数据集都有优化。
ArrayTable | 要求在构造时就指定行和列的大小，本质上由一个二维数组实现，以提升访问速度和密集Table的内存利用率。

ArrayTable与其他Table的工作原理有点不同，请参见Javadoc了解详情。

### ClassToInstanceMap实现：

它的键是类型，而值是符合键所指类型的对象。

`ClassToInstanceMap<B>`实现了`Map<Class<? extends B>, B>`

实现 | 描述
--|--
MutableClassToInstanceMap | -
ImmutableClassToInstanceMap | -

### RangeSet

RangeSet描述了一组不相连的、非空的区间。

    当把一个区间添加到可变的RangeSet时，所有相连的区间会被合并，空区间会被忽略。

### RangeMap

RangeMap描述了”不相交的、非空的区间”到特定值的映射。

和RangeSet不同，RangeMap不会合并相邻的映射，即便相邻的区间映射到相同的值。